devices: 1
accelerator: gpu
distributed_backend: ddp
seed: 0
debug: false
fast_dev_run: false
max_epochs: 100

image_net_path: null
cifar10_path: null
simple_shapes_path: null

visual_dataset: "shapes"

img_size: 32

n_validation_examples: 32

slurm:
  script: train
  slurm:
    "-N": 1
    "--gres": "gpu:${devices}"
    "--time": "12:00:00"
    "--mem": 5000

fetchers:
  t:
    bert_latents: bert-base-uncased_simple.npy

vae:
  batch_size: 128
  data_augmentation: true

  beta: 0.5
  z_size: 12
  ae_size: 512
  type: "optimal_sigma"

  n_FID_samples: 1000

  early_stopping_patience: null  # no early stopping
  optim:
    lr: 1e-4
    weight_decay: 3e-5
  scheduler:
    step: 20
    gamma: 0.5

lm:
  z_size: 12

  batch_size: 128
  n_validation_examples: 32
  early_stopping_patience: null
  optim:
    lr: 1e-4
    weight_decay: 3e-5
  scheduler:
    step: 10
    gamma: 0.1

global_workspace:
  monitor_grad_norms: false  # if true, training is a bit slower.
  batch_size: 128
  data_augmentation: false
  selected_domains: null
  sync_uses_whole_dataset: false

  use_pre_saved: false
  load_pre_saved_latents: null

  split_ood: false
  bert_path: "bert-base-uncased"

  z_size: 20
  hidden_size: 512
  n_layers:
    encoder: 0
    decoder: 0
    decoder_head: 0
  prop_labelled_images: [1., 1.]  # of the allowed classes to be labelled.
  remove_sync_domains: null
  classes_labelled_images: null  # null is all classes
  vae_checkpoint: null
  lm_checkpoint: null
  vae_mmd_loss_coef: 0.
  vae_kl_loss_coef: 0.

  early_stopping_patience: 10
  optim:
    lr:
      encoders: 1e-4
      decoders: 1e-4
      supervised_multiplier: 1.
      unsupervised_multiplier: 1.
    weight_decay: 3e-5

  scheduler:
    # "fixed"/"adaptive".
    # - Fixed will use the following values.
    # - Adaptive will change the values based on the prop_labelled_image setting.
    #   The given values are the one used if prop_labelled_images is set to 1.
    mode: fixed
    interval: epoch
    step: 20
    gamma: 0.5

losses:
  schedules: null
  coefs:
    demi_cycles: 0.
    cycles: 0.
    supervision: 1.
    cosine: 0.
    contrastive: 1.3

gensim_model_path: null
word_embeddings: null

dataloader:
  num_workers: 0

loggers:
  - logger: TensorBoardLogger
    save_images: true
    args:
      save_dir: "../logs/tensor_board_logger"
#  - logger: CSVLogger
#    save_images: true
#    args:
#      save_dir: "../logs/csv_logger"
#  - logger: NeptuneLogger
#    save_images: true
#    args:
#      project: null
#      api_key: null
#      mode: async
#      run: null

odd_image:
  batch_size: 512
  encoder_path: null  # path to checkpoint
  csv_ids: null

  optimizer:
    lr: 1e-3
    weight_decay: 1e-5

checkpoints_dir: ???
resume_from_checkpoint: null
_code_version: fusion
